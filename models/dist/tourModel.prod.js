"use strict";var mongoose=require("mongoose"),slugify=require("slugify"),tourSchema=new mongoose.Schema({name:{type:String,required:[!0,"A tour must have a name"],unique:!0,trim:!0,maxlength:[40,"A Tour name must have max length of 40"],minlength:[10,"A Tour name must have min length of 10"]},slug:String,duration:{type:Number,required:[!0,"A tour must have a duration"]},maxGroupSize:{type:Number,required:[!0,"A tour must have a group size"]},difficulty:{type:String,required:[!0,"A tour must have some difficulty level"],enum:{values:["easy","medium","difficult"],message:"Difficulty is either: easy,medium,difficult"}},ratingsQuantity:{type:Number,default:0},ratingsAverage:{type:Number,default:4.5,min:[1,"Rating must be above 1"],max:[5,"Rating must be below 5"]},rating:{type:Number,default:4.5},price:{type:Number,required:[!0,"Tour Must Have A Price"]},priceDiscount:{type:Number,validate:function(e){return e<this.price}},summary:{type:String,trim:!0,required:[!0,"A tour must have a description"]},description:{type:String,trim:!0},imageCover:{type:String,required:[!0,"A tour must have a description "]},images:[String],createdAt:{type:Date,default:Date.now()},startDates:[Date],secretTour:{type:Boolean,default:!1},startLocation:{type:{type:String,default:"Point",enum:["Point"]},coordinates:[Number],address:String,description:String},locations:[{type:{type:String,default:"Point",enum:["Point"]},coordinates:[Number],address:String,description:String,day:Number}],guides:[{type:mongoose.Schema.ObjectId,ref:"User"}]},{toJSON:{virtuals:!0},toObject:{virtuals:!0}});tourSchema.index({price:1,ratingsAverage:-1}),tourSchema.index({slug:1}),tourSchema.index({startLocation:"2dsphere"}),tourSchema.virtual("durationWeeks").get(function(){return this.duration/7}),tourSchema.virtual("reviews",{ref:"Review",foreignField:"tour",localField:"_id"}),tourSchema.pre("save",function(e){this.slug=slugify(this.name,{lower:!0}),e()}),tourSchema.pre(/^find/,function(e){this.find({secretTour:{$ne:!0}}),this.start=Date.now(),e()}),tourSchema.pre(/^find/,function(e){this.populate({path:"guides",select:"-__v -passwordChangedAt"}),e()}),tourSchema.post(/^find/,function(e,t){t()});var Tour=mongoose.model("Tour",tourSchema);module.exports=Tour;