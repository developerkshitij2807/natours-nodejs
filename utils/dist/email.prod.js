"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var nodemailer=require("nodemailer"),pug=require("pug"),htmlToText=require("html-to-text");module.exports=function(){function t(e,r){_classCallCheck(this,t),this.to=e.email,this.firstName=e.name.split(" ")[0],this.url=r,this.from="Kshitij Dutt <".concat(process.env.EMAIL_FROM,">")}return _createClass(t,[{key:"newTransport",value:function(){return"production"===process.env.NODE_ENV?1:nodemailer.createTransport({host:process.env.EMAIL_HOST,port:process.env.EMAIL_PORT,auth:{user:process.env.EMAIL_USERNAME,pass:process.env.EMAIL_PASSWORD}})}},{key:"send",value:function(r,t){var n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=pug.renderFile("".concat(__dirname,"/../views/emails/").concat(r,".pug"),{firstName:this.firstName,url:this.url,subject:t}),s={from:this.from,to:this.to,subject:t,html:n,text:htmlToText.fromString(n)},e.next=4,regeneratorRuntime.awrap(this.newTransport().sendMail(s));case 4:case"end":return e.stop()}},null,this)}},{key:"sendWelcome",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.send("welcome","Welcome to the Natours Family!"));case 2:case"end":return e.stop()}},null,this)}}]),t}();var sendEmail=function(r){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=nodemailer.createTransport({host:process.env.EMAIL_HOST,secure:!1,port:process.env.EMAIL_PORT,auth:{user:process.env.EMAIL_USERNAME,pass:process.env.EMAIL_PASSWORD},tls:{rejectUnauthorized:!1}}),n={from:"Admin <test@inbox.mailtrap.io>",to:r.email,subject:r.subject,text:r.message},e.next=4,regeneratorRuntime.awrap(t.sendMail(n));case 4:case"end":return e.stop()}})};module.exports=sendEmail;