"use strict";var path=require("path"),express=require("express"),morgan=require("morgan"),rateLimit=require("express-rate-limit"),helmet=require("helmet"),mongoSanitize=require("express-mongo-sanitize"),xss=require("xss-clean"),hpp=require("hpp"),cookieParser=require("cookie-parser"),AppError=require("./utils/appError"),globalErrorHandler=require("./controller/errorController"),tourRouter=require("./routes/tourRoutes.js"),userRouter=require("./routes/userRoutes.js"),reviewRouter=require("./routes/reviewRoutes.js"),viewRouter=require("./routes/viewRoutes.js"),app=express();app.set("view engine","pug"),app.set("views",path.join(__dirname,"views")),app.use(express.static(path.join(__dirname,"public"))),app.use(express.json()),app.use(helmet()),"development"===process.env.NODE_ENV&&app.use(morgan("dev"));var limiter=rateLimit({max:100,windowMs:36e5,message:"Too many requests from this IP, please try again in the hour"});app.use("/api",limiter),app.use(express.json({limit:"10kb"})),app.use(cookieParser()),app.use(function(e,r,s){e.requestTime=(new Date).toISOString(),s()}),app.use("/",viewRouter),app.use("/api/v1/tours",tourRouter),app.use("/api/v1/users",userRouter),app.use("/api/v1/reviews",reviewRouter),app.use(mongoSanitize()),app.use(xss()),app.use(hpp({whitelist:["duration","ratingsQuantity","ratingsAverage","maxGroupSize","difficulty","price"]})),app.all("*",function(e,r,s){s(new AppError("Can't find ".concat(e.originalUrl," on the server"),404))}),app.use(globalErrorHandler),module.exports=app;